<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../assets/Logos/Logo-Icon.ico" type="image/x-icon">
    <title>Détails Employé</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <div class="logo"><img src="Logo.png" alt="Logo"></div>
        <nav class="menu">
            <a href="dashboard.html" class="menu-item">
                <i data-lucide="layout-dashboard"></i> Tableau de bord
            </a>
            <a href="employes-liste.html" class="menu-item active">
                <i data-lucide="arrow-left"></i> Retour Liste
            </a>
        </nav>
    </aside>

    <main class="main">
        <header class="header">
            <h1>Profil Employé</h1>
            <button onclick="deleteCurrentEmployee()" class="btn btn-logout" style="background: var(--danger);">
                <i data-lucide="trash-2"></i> Supprimer
            </button>
        </header>

        <div class="card">
            <div class="profile-header">
                <div class="profile-avatar" id="headerAvatar">--</div>
                <div class="profile-info">
                    <h2 id="headerName">Chargement...</h2>
                    <div class="role" id="headerRole">...</div>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="value" id="headerStatus">Actif</div>
                            <div class="label">Statut Actuel</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('infos')"><i data-lucide="user"></i> Informations</button>
                <button class="tab" onclick="switchTab('contrat')"><i data-lucide="briefcase"></i> Contrat & Emploi</button>
                <button class="tab" onclick="switchTab('conges')"><i data-lucide="calendar-off"></i> Gestion Congés</button>
            </div>

            <div id="tab-infos" class="tab-content active">
                <form onsubmit="saveChanges(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prénom</label>
                            <input type="text" id="editFirst" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Nom</label>
                            <input type="text" id="editLast" class="form-input">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="editEmail" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Téléphone</label>
                            <input type="tel" id="editPhone" class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Adresse</label>
                        <textarea id="editAddress" class="form-input" rows="3"></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary"><i data-lucide="save"></i> Sauvegarder Infos</button>
                    </div>
                </form>
            </div>

            <div id="tab-contrat" class="tab-content">
                <form onsubmit="saveChanges(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Poste</label>
                            <select id="editRole" class="form-input">
                                <option value="chef">Chef cuisinier</option>
                                <option value="sous-chef">Sous-chef</option>
                                <option value="commis">Commis de cuisine</option>
                                <option value="serveur">Serveur</option>
                                <option value="maitre">Maître d'hôtel</option>
                                <option value="barman">Barman</option>
                                <option value="plongeur">Plongeur</option>
                                <option value="gestionnaire">Gestionnaire</option>
                                <option value="manager">Manager</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Département</label>
                            <select id="editDepartment" class="form-input">
                                <option value="cuisine">Cuisine</option>
                                <option value="salle">Service en salle</option>
                                <option value="bar">Bar</option>
                                <option value="administration">Administration</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Date d'embauche</label>
                            <input type="date" id="editHireDate" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Salaire Mensuel (MAD)</label>
                            <input type="number" id="editSalary" class="form-input">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Type de contrat</label>
                            <select id="editContractType" class="form-input">
                                <option value="cdi">CDI</option>
                                <option value="cdd">CDD</option>
                                <option value="interim">Intérim</option>
                                <option value="saisonnier">Saisonnier</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Heures/semaine</label>
                            <select id="editWorkHours" class="form-input">
                                <option value="35">35h</option>
                                <option value="39">39h</option>
                                <option value="40">40h</option>
                                <option value="45">45h</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="editNotes" class="form-input" rows="3"></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary"><i data-lucide="save"></i> Sauvegarder Contrat</button>
                    </div>
                </form>
            </div>

            <div id="tab-conges" class="tab-content">
                <h3>Statut et Accès</h3>
                <div class="form-group" style="margin-top:20px;">
                    <label>Changer le statut de l'employé :</label>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <button onclick="updateStatus('active')" class="btn" style="background:var(--success); color:white;">
                            <i data-lucide="check-circle"></i> Mettre Actif
                        </button>
                        <button onclick="updateStatus('conge')" class="btn" style="background:var(--warning); color:white;">
                            <i data-lucide="clock"></i> Mettre en Congé
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="employee-data.js"></script>
    <script src="main.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const empId = urlParams.get('id');
        let currentEmp = null;

        document.addEventListener('DOMContentLoaded', () => {
            if(!empId) { alert("Aucun ID"); window.location.href = 'employes-liste.html'; return; }
            
            currentEmp = EmployeeDB.getById(empId);
            if(!currentEmp) { alert("Employé introuvable"); window.location.href = 'employes-liste.html'; return; }

            fillData();
        });

        function fillData() {
            // Header Info
            document.getElementById('headerName').textContent = `${currentEmp.firstName} ${currentEmp.lastName}`;
            document.getElementById('headerAvatar').textContent = (currentEmp.firstName[0] + currentEmp.lastName[0]).toUpperCase();
            document.getElementById('headerRole').textContent = currentEmp.role;
            document.getElementById('headerStatus').textContent = currentEmp.status === 'active' ? "Au travail" : "En congé";
            
            // Tab 1: Personal Info
            document.getElementById('editFirst').value = currentEmp.firstName || '';
            document.getElementById('editLast').value = currentEmp.lastName || '';
            document.getElementById('editEmail').value = currentEmp.email || '';
            document.getElementById('editPhone').value = currentEmp.phone || '';
            document.getElementById('editAddress').value = currentEmp.address || '';

            // Tab 2: Contract Info
            document.getElementById('editRole').value = currentEmp.role || '';
            document.getElementById('editDepartment').value = currentEmp.department || '';
            document.getElementById('editHireDate').value = currentEmp.hireDate || '';
            document.getElementById('editSalary').value = currentEmp.salary || '';
            document.getElementById('editContractType').value = currentEmp.contractType || '';
            document.getElementById('editWorkHours').value = currentEmp.workHours || '';
            document.getElementById('editNotes').value = currentEmp.notes || '';
        }

        function saveChanges(e) {
            e.preventDefault(); 
            // Update local object with ALL fields
            currentEmp.firstName = document.getElementById('editFirst').value;
            currentEmp.lastName = document.getElementById('editLast').value;
            currentEmp.email = document.getElementById('editEmail').value;
            currentEmp.phone = document.getElementById('editPhone').value;
            currentEmp.address = document.getElementById('editAddress').value;
            currentEmp.role = document.getElementById('editRole').value;
            currentEmp.department = document.getElementById('editDepartment').value;
            currentEmp.hireDate = document.getElementById('editHireDate').value;
            currentEmp.salary = document.getElementById('editSalary').value;
            currentEmp.contractType = document.getElementById('editContractType').value;
            currentEmp.workHours = document.getElementById('editWorkHours').value;
            currentEmp.notes = document.getElementById('editNotes').value;
            
            // Save to DB
            EmployeeDB.update(currentEmp);
            
            alert("Modifications enregistrées avec succès !");
            fillData(); 
        }

        function updateStatus(newStatus) {
            currentEmp.status = newStatus;
            EmployeeDB.update(currentEmp);
            fillData();
            alert(`Statut mis à jour : ${newStatus}`);
        }

        function deleteCurrentEmployee() {
            if(confirm("Êtes-vous sûr de vouloir supprimer définitivement cet employé ?")) {
                EmployeeDB.delete(empId);
                window.location.href = 'employes-liste.html';
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Refresh icons in case they got lost in DOM manipulation (unlikely here but good practice)
            if(window.lucide) lucide.createIcons();
        }
    </script>
</body>
</html>